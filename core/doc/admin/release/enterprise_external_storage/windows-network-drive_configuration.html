<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installing and Configuring the Windows Network Drive App &mdash; ownCloud 9.1 Server Administration Manual 9.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/main.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '9.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="ownCloud 9.1 Server Administration Manual 9.1 documentation" href="../contents.html" />
    <link rel="up" title="External Storage (Enterprise only)" href="index.html" />
    <link rel="next" title="Configuring S3 and OpenStack Swift Objects as Primary Storage" href="s3_swift_as_primary_object_store_configuration.html" />
    <link rel="prev" title="Configuring SharePoint Integration" href="sharepoint-integration_configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1d2d44">

  </head>
  <body role="document">


<div class="wrap container not-front">
  <div class="content row">
  <main class="main">
    <div class="row page-content-header">
      <div class="col-md-5 col-md-offset-7">
      
        <form class="headersearch" style="margin-bottom:-3px;" action="../search.html" method="get">
        <input type="text" value="" name="q" id="q" class="form-control" /> 
        <button  class="btn btn-default" type="submit" id="searchsubmit">Search</button>
        </form>
      
      </div>
    </div>
    
			<div class="row">
				<div class="col-md-3">
					<div class="sidebar">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ownCloud 9.1 Server Administration Manual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">ownCloud 9.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 9.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_server/index.html">ownCloud Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_user/index.html">User Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_files/index.html">File Sharing and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_database/index.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_mimetypes/index.html">Mimetypes Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../enterprise_installation/index.html">Enterprise Edition Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_clients/index.html">Creating Branded ownCloud Clients (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_server_branding/index.html">Enterprise Server Branding (Enterprise only)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">External Storage (Enterprise only)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="enterprise_only_auth.html">Enterprise-Only Authentication Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap_home_connector_configuration.html">LDAP Home Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharepoint-integration_configuration.html">Configuring SharePoint Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Installing and Configuring the Windows Network Drive App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-new-share">Creating a New Share</a></li>
<li class="toctree-l3"><a class="reference internal" href="#personal-wnd-mounts">Personal WND Mounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libsmclient-issues">libsmclient Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#windows-network-drive-listener">Windows Network Drive Listener</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-notifications-for-an-smb-share">Setup Notifications for an SMB Share</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-listener-for-many-shares">One Listener for Many Shares</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-wnd-listener-as-a-service">Running the WND Listener as a Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="s3_swift_as_primary_object_store_configuration.html">Configuring S3 and OpenStack Swift Objects as Primary Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="jive_configuration.html">Jive Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_user_management/index.html">User Management (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_file_management/index.html">Enterprise File Management (Enterprise Only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_logging/index.html">Enterprise Logging Apps (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_firewall/index.html">Enterprise Firewall (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_troubleshooting.html">Enterprise Troubleshooting</a></li>
</ul>

								</ul>
							</div>
					</div>
				</div>
        

				<div class="col-md-9">
					<div class="page-content">
            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="sharepoint-integration_configuration.html" title="Previous Chapter: Configuring SharePoint Integration"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Configuring S...</span>
    </a>
  </li>
  <li class="next">
    <a href="s3_swift_as_primary_object_store_configuration.html" title="Next Chapter: Configuring S3 and OpenStack Swift Objects as Primary Storage"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Configuring S... &raquo;</span>
    </a>
  </li>
</ul>
						
  <div class="section" id="installing-and-configuring-the-windows-network-drive-app">
<h1>Installing and Configuring the Windows Network Drive App<a class="headerlink" href="#installing-and-configuring-the-windows-network-drive-app" title="Permalink to this headline">¶</a></h1>
<p>The Windows Network Drive app creates a control panel on your Admin page for
seamless mounting of SMB/CIFS file shares on ownCloud servers.</p>
<p>Any Windows file share, and Samba servers on Linux and other Unix-type operating
systems use the SMB/CIFS file-sharing protocol. The files and directories on the
SMB/CIFS server will be visible on your Files page just like your other ownCloud
files and folders. They are labeled with a little four-pane Windows-style icon,
and the left pane of your Files page includes a Windows Network Drive filter.
Figure 1 shows a new Windows Network Drive share marked with red warnings.
These indicate that ownCloud cannot connect to the share because it requires
the user to login, it is not available, or there is an error in the
configuration.</p>
<div class="figure" id="id1">
<img alt="Windows Network Drive share on your Files page." src="../_images/wnd-1.png" />
<p class="caption"><span class="caption-text"><em>Figure 1: Windows Network Drive share on your Files page.</em></span></p>
</div>
<p>Files are synchronized bi-directionally, and you can create, upload, and delete
files and folders. ownCloud server admins can create Windows Network Drive
mounts, and optionally allow users to create their own personal Windows Network
Drive mounts.</p>
<p>Depending on the authentication method, passwords for each mount are encrypted
and stored in the ownCloud database, using a long random secret key stored in
<code class="docutils literal"><span class="pre">config.php</span></code>, which allows ownCloud to access the shares when the users who
own the mounts are not logged in. Or, passwords are not stored and available
only for the current session, which adds security.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Enable the Windows Network Drive app on your ownCloud Apps page. Then there are
a few dependencies to install.</p>
<p>You must install <code class="docutils literal"><span class="pre">php-smbclient</span></code>. This should be included in most Linux distributions. See <a class="reference external" href="https://github.com/eduardok/libsmbclient-php">eduardok/libsmbclient-php</a> if your distribution does not include it; this provides source archives and instructions for installing binary packages.</p>
<p>You also need the Samba client installed on your Linux system. This is included in
all Linux distributions; on Debian, Ubuntu, and other Debian derivatives this
is <code class="docutils literal"><span class="pre">smbclient</span></code>. On SUSE, Red Hat, CentOS, and other Red Hat derivatives it is
<code class="docutils literal"><span class="pre">samba-client</span></code>. You also need <code class="docutils literal"><span class="pre">which</span></code> and <code class="docutils literal"><span class="pre">stdbuf</span></code>, which should be included in most Linux distributions.</p>
</div>
<div class="section" id="creating-a-new-share">
<h2>Creating a New Share<a class="headerlink" href="#creating-a-new-share" title="Permalink to this headline">¶</a></h2>
<p>When you create a new WND share you need the login credentials for the share,
the server address, the share name, and the folder you want to connect to.</p>
<ol class="arabic simple">
<li>First enter the ownCloud mountpoint for your new WND share. This must not be
an existing folder.</li>
<li>Then select your authentication method; See <a class="reference internal" href="enterprise_only_auth.html"><em>Enterprise-Only Authentication Options</em></a> for
complete information on the five available authentication methods.</li>
</ol>
<div class="figure" id="id2">
<img alt="WND mountpoint and auth." src="../_images/wnd-2.png" />
<p class="caption"><span class="caption-text"><em>Figure 2: WND mountpoint and authorization credentials.</em></span></p>
</div>
<ol class="arabic simple" start="3">
<li>Enter the address of the server that contains the WND share.</li>
<li>The Windows share name.</li>
<li>The root folder of the share. This is the folder name, or the
<code class="docutils literal"><span class="pre">$user</span></code> variable for user&#8217;s home directories. Note that the LDAP
<code class="docutils literal"><span class="pre">Internal</span> <span class="pre">Username</span> <span class="pre">Attribute</span></code> must be set to the <code class="docutils literal"><span class="pre">samaccountname</span></code> for
either the share or the root to work, and the user&#8217;s home directory needs
to match the <code class="docutils literal"><span class="pre">samaccountname</span></code>. (See
<a class="reference internal" href="../configuration_user/user_auth_ldap.html"><em>User Authentication with LDAP</em></a>.)</li>
<li>Login credentials.</li>
<li>Select users or groups with access to the share. The default is all users.</li>
<li>Click the gear icon for additional mount options. Note that encryption is
enabled by default, while sharing is not. Sharing is not available for all
authorization methods; see <a class="reference internal" href="enterprise_only_auth.html"><em>Enterprise-Only Authentication Options</em></a>.</li>
</ol>
<div class="figure" id="id3">
<img alt="WND server and credentials." src="../_images/wnd-3.png" />
<p class="caption"><span class="caption-text"><em>Figure 3: WND server, credentials, and additional mount options.</em></span></p>
</div>
<p>Your changes are saved automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you create a new mountpoint using Login credentials you must log
out of ownCloud, and then log back in so you can access the share. You
only have to do this the first time.</p>
</div>
</div>
<div class="section" id="personal-wnd-mounts">
<h2>Personal WND Mounts<a class="headerlink" href="#personal-wnd-mounts" title="Permalink to this headline">¶</a></h2>
<p>Users create their own personal WND mounts on their Personal pages. These are
created the same way as Admin-created shares. Users have four options for
login credentials:</p>
<ul class="simple">
<li>Username and password</li>
<li>Log-in credentials, save in session</li>
<li>Log-in credentials, save in database</li>
<li>Global credentials</li>
</ul>
</div>
<div class="section" id="libsmclient-issues">
<h2>libsmclient Issues<a class="headerlink" href="#libsmclient-issues" title="Permalink to this headline">¶</a></h2>
<p>If your Linux distribution ships with <code class="docutils literal"><span class="pre">libsmbclient</span> <span class="pre">3.x</span></code>, which is included in
the Samba client, you may need to set up the HOME variable in Apache to prevent
a segmentation fault. If you have <code class="docutils literal"><span class="pre">libsmbclient</span> <span class="pre">4.1.6</span></code> and higher it doesn&#8217;t
seem to be an issue, so you won&#8217;t have to change your HOME variable.</p>
<p>To set up the HOME variable on Ubuntu, modify the <code class="docutils literal"><span class="pre">/etc/apache2/envvars</span></code>
file:</p>
<div class="highlight-python"><div class="highlight"><pre>unset HOME
export HOME=/var/www
</pre></div>
</div>
<p>In Red Hat/CentOS, modify the <code class="docutils literal"><span class="pre">/etc/sysconfig/httpd</span></code> file and add the
following line to set the HOME variable in Apache:</p>
<div class="highlight-python"><div class="highlight"><pre>export HOME=/usr/share/httpd
</pre></div>
</div>
<p>By default CentOS has activated SELinux, and the <code class="docutils literal"><span class="pre">httpd</span></code> process can not make
outgoing network connections. This will cause problems with the <code class="docutils literal"><span class="pre">curl</span></code>,
<code class="docutils literal"><span class="pre">ldap</span></code>
and <code class="docutils literal"><span class="pre">samba</span></code> libraries. You&#8217;ll need to get around this in order to make
this work. First check the status:</p>
<div class="highlight-python"><div class="highlight"><pre>getsebool -a | grep httpd
httpd_can_network_connect --&gt; off
</pre></div>
</div>
<p>Then enable support for network connections:</p>
<div class="highlight-python"><div class="highlight"><pre>setsebool -P httpd_can_network_connect 1
</pre></div>
</div>
<p>In openSUSE, modify the <code class="docutils literal"><span class="pre">/usr/sbin/start_apache2</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre>export HOME=/var/lib/apache2
</pre></div>
</div>
<p>Restart Apache, open your ownCloud Admin page and start creating SMB/CIFS
mounts.</p>
</div>
</div>
<div class="section" id="windows-network-drive-listener">
<h1>Windows Network Drive Listener<a class="headerlink" href="#windows-network-drive-listener" title="Permalink to this headline">¶</a></h1>
<p>The SMB protocol supports registering for notifications of file changes on remote Windows SMB storage servers. Notifications are more efficient than polling for changes, as polling requires scanning the whole SMB storage. ownCloud supports SMB notifications with an <code class="docutils literal"><span class="pre">occ</span></code> command, <code class="docutils literal"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The notifier only works with remote storages on Windows servers. It does not work reliably with Linux servers due to technical limitations.</p>
</div>
<p>Your <code class="docutils literal"><span class="pre">smbclient</span></code> versions needs to be 4.x, as older versions do not support notifications.</p>
<p>The ownCloud server needs to know about changes of files on integrated storages so that the changed files will be synced to the ownCloud server, and to desktop sync clients. Files changed through the ownCloud Web interface or sync clients are automatically updated in the ownCloud filecache, but this is not possible when files are changed directly on remote SMB storage mounts.</p>
<p>To create a new SMB notification, start a listener on your ownCloud server with <code class="docutils literal"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code>. The listener marks changed files, and a background job updates the file metadata.</p>
<div class="section" id="setup-notifications-for-an-smb-share">
<h2>Setup Notifications for an SMB Share<a class="headerlink" href="#setup-notifications-for-an-smb-share" title="Permalink to this headline">¶</a></h2>
<p>If you don&#8217;t already have an SMB share, you must create one. Then start the listener with this command, like this example for Ubuntu Linux:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo -u www-data php occ wnd:listen &lt;host&gt; &lt;share&gt; &lt;username&gt; [password]
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">host</span></code> is your remote SMB server, which must be exactly the same as the server name in your WND configuration on your ownCloud Admin page. <code class="docutils literal"><span class="pre">share</span></code> is the share name, and <code class="docutils literal"><span class="pre">username</span></code> and <code class="docutils literal"><span class="pre">password</span></code> are the login credentials for the share. By default there is no output. Enable verbosity to see the notifications:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo -u www-data php occ wnd:listen -v server share useraccount
Please enter the password to access the share:
File removed : Capirotes/New Text Document.txt
File modified : Capirotes
File added : Capirotes/New Text Document.txt
File modified : Capirotes
File renamed : old name : Capirotes/New Text Document.txt
File renamed : new name : Capirotes/New Document.txt
</pre></div>
</div>
<p>Enable increased verbosity to see debugging messages, including which storages are updated and timing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo -u www-data php occ wnd:listen -vvv server share useraccount
Please enter the password to access the share:
notification received in 1471450242
File removed : Capirotes/New Document.txt
found 1 related storages from mount id 1
updated storage wnd::admin@server/share// from mount id 1 -&gt; removed internal path : Capirotes/New Document.txt
found 1 related storages from mount id 3
updated storage wnd::administrador@server/share// from mount id 3 -&gt; removed internal path : Capirotes/New Document.txt
found 1 related storages from mount id 2
</pre></div>
</div>
<p>See <a class="reference internal" href="../configuration_server/occ_command.html"><em>Using the occ Command</em></a> for detailed help with <code class="docutils literal"><span class="pre">occ</span></code>.</p>
</div>
<div class="section" id="one-listener-for-many-shares">
<h2>One Listener for Many Shares<a class="headerlink" href="#one-listener-for-many-shares" title="Permalink to this headline">¶</a></h2>
<p>As the ownCloud server admin you can setup an SMB share for all of your users with a <code class="docutils literal"><span class="pre">$user</span></code>
template variable in the root path. By using a ServiceUser you can listen to the common share path. The ServiceUser is any user with access to the share. You might create a special read-only user account to use in this case.</p>
<p>Example:</p>
<p>Share <code class="docutils literal"><span class="pre">/home</span></code> contains folders for every user, e.g. <code class="docutils literal"><span class="pre">/home/alice</span></code>
and <code class="docutils literal"><span class="pre">/home/bob</span></code>. So the admin configures the Windows Network Drive external storage with these values:</p>
<ul class="simple">
<li>Folder name: home</li>
<li>Storage Type: Windows Network Drive</li>
<li>Authentication: Log-in credentials, save in database</li>
<li>Configuration
<code class="docutils literal"><span class="pre">host:</span> <span class="pre">&quot;172.18.16.220&quot;,</span> <span class="pre">share:</span> <span class="pre">&quot;home&quot;,</span> <span class="pre">remote</span> <span class="pre">subfolder:</span> <span class="pre">&quot;$user&quot;,</span> <span class="pre">domain:</span> <span class="pre">&quot;&quot;</span></code></li>
</ul>
<p>Then starts the <code class="docutils literal"><span class="pre">wnd:listen</span></code> thread:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo -u www-data occ wnd:listen 172.18.16.220 home ServiceUser Password
</pre></div>
</div>
<p>Changes made by Bob or Alice made directly on the storage are now detected by the ownCloud server.</p>
</div>
<div class="section" id="running-the-wnd-listener-as-a-service">
<h2>Running the WND Listener as a Service<a class="headerlink" href="#running-the-wnd-listener-as-a-service" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/owncloud/documentation/wiki/Configuring-wnd:listen-to-run-as-a-service">Configuring wnd:listen to run as a service</a> in the documentation wiki for tips on running the listenera as a service via cron, and by creating a Systemd startup script.</p>
</div>
</div>


            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="sharepoint-integration_configuration.html" title="Previous Chapter: Configuring SharePoint Integration"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Configuring S...</span>
    </a>
  </li>
  <li class="next">
    <a href="s3_swift_as_primary_object_store_configuration.html" title="Next Chapter: Configuring S3 and OpenStack Swift Objects as Primary Storage"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Configuring S... &raquo;</span>
    </a>
  </li>
</ul>
					</div>
				</div>
			</div>
  </main>  
  </div>
</div>
  </body>
</html>